<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-blueprints/streaming-platforms/kafka" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Kafka on EKS | Data on EKS</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://awslabs.github.io/data-on-eks/docs/blueprints/streaming-platforms/kafka"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Kafka on EKS | Data on EKS"><meta data-rh="true" name="description" content="Apache Kafka is an open-source distributed event streaming platform used by thousands of companies for high-performance data pipelines, streaming analytics, data integration, and mission-critical applications."><meta data-rh="true" property="og:description" content="Apache Kafka is an open-source distributed event streaming platform used by thousands of companies for high-performance data pipelines, streaming analytics, data integration, and mission-critical applications."><link data-rh="true" rel="icon" href="/data-on-eks/img/header-icon.png"><link data-rh="true" rel="canonical" href="https://awslabs.github.io/data-on-eks/docs/blueprints/streaming-platforms/kafka"><link data-rh="true" rel="alternate" href="https://awslabs.github.io/data-on-eks/docs/blueprints/streaming-platforms/kafka" hreflang="en"><link data-rh="true" rel="alternate" href="https://awslabs.github.io/data-on-eks/docs/blueprints/streaming-platforms/kafka" hreflang="x-default"><link rel="stylesheet" href="/data-on-eks/assets/css/styles.7e16996c.css">
<script src="/data-on-eks/assets/js/runtime~main.e4876b1e.js" defer="defer"></script>
<script src="/data-on-eks/assets/js/main.da9d81cd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_gu5v" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/data-on-eks/"><div class="navbar__logo"><img src="/data-on-eks/img/header-icon.png" alt="DoEKS Logo" class="themedComponent_ZRzL themedComponent--light_dGsa"><img src="/data-on-eks/img/header-icon.png" alt="DoEKS Logo" class="themedComponent_ZRzL themedComponent--dark_pzCA"></div></a><a class="navbar__item navbar__link" href="/data-on-eks/docs/introduction/intro">Introduction</a><a class="navbar__item navbar__link" href="/data-on-eks/docs/gen-ai">Gen AI</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/data-on-eks/docs/blueprints/amazon-emr-on-eks">Blueprints</a><a class="navbar__item navbar__link" href="/data-on-eks/docs/bestpractices/intro">Best Practices</a><a class="navbar__item navbar__link" href="/data-on-eks/docs/benchmarks/emr-on-eks">Benchmarks</a><a class="navbar__item navbar__link" href="/data-on-eks/docs/resources/intro">Resources</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/awslabs/data-on-eks" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_T11m"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_kWbt colorModeToggle_GwZs"><button class="clean-btn toggleButton_fOL9 toggleButtonDisabled_STpu" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_DCeJ"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_DFgp"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_IP3a"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_IbdI"><div class="docsWrapper_JGIH"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_SdI4" type="button"></button><div class="docRoot_eRbX"><aside class="theme-doc-sidebar-container docSidebarContainer_Ta75"><div class="sidebarViewport_fgog"><div class="sidebar_oDHW"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_vPEQ"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/data-on-eks/docs/category/amazon-emr-on-eks">Amazon EMR on EKS</a><button aria-label="Expand sidebar category &#x27;Amazon EMR on EKS&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/data-on-eks/docs/category/data-analytics-on-eks">Data Analytics on EKS</a><button aria-label="Expand sidebar category &#x27;Data Analytics on EKS&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/data-on-eks/docs/category/aiml-on-eks">AI/ML on EKS</a><button aria-label="Expand sidebar category &#x27;AI/ML on EKS&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/data-on-eks/docs/category/job-schedulers-on-eks">Job Schedulers on EKS</a><button aria-label="Expand sidebar category &#x27;Job Schedulers on EKS&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/data-on-eks/docs/category/streaming-platforms-on-eks">Streaming Platforms on EKS</a><button aria-label="Collapse sidebar category &#x27;Streaming Platforms on EKS&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/data-on-eks/docs/blueprints/streaming-platforms">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/data-on-eks/docs/blueprints/streaming-platforms/emr-eks-stream">EMR on EKS with Spark Streaming</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/data-on-eks/docs/blueprints/streaming-platforms/flink">Flink Operator on EKS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/data-on-eks/docs/blueprints/streaming-platforms/kafka">Kafka on EKS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/data-on-eks/docs/blueprints/streaming-platforms/nifi">Apache NiFi on EKS</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/data-on-eks/docs/category/distributed-databases-on-eks">Distributed Databases on EKS</a><button aria-label="Expand sidebar category &#x27;Distributed Databases on EKS&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/data-on-eks/docs/blueprints/troubleshooting">Troubleshooting</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_Cq4q"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_eHqP"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_lg0V"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_nDJs"><div class="docItemContainer_OGiL"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_k3Z9" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/data-on-eks/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_JACu"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/data-on-eks/docs/category/streaming-platforms-on-eks"><span itemprop="name">Streaming Platforms on EKS</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Kafka on EKS</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_QCOD theme-doc-toc-mobile tocMobile_N0YI"><button type="button" class="clean-btn tocCollapsibleButton_pHwF">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Apache Kafka</h1>
<p><a href="https://kafka.apache.org/" target="_blank" rel="noopener noreferrer">Apache Kafka</a> is an open-source distributed event streaming platform used by thousands of companies for high-performance data pipelines, streaming analytics, data integration, and mission-critical applications.</p>
<h2 class="anchor anchorWithStickyNavbar_FNw8" id="strimzi-for-apache-kafka">Strimzi for Apache Kafka<a href="#strimzi-for-apache-kafka" class="hash-link" aria-label="Direct link to Strimzi for Apache Kafka" title="Direct link to Strimzi for Apache Kafka">​</a></h2>
<p><a href="https://strimzi.io/" target="_blank" rel="noopener noreferrer">Strimzi</a> provides a way to run an Apache Kafka cluster on Kubernetes in various deployment configurations.
Strimzi combines security and simple configuration to deploy and manage Kafka on Kubernetes using kubectl and/or GitOps based on the Operator Pattern.</p>
<h2 class="anchor anchorWithStickyNavbar_FNw8" id="architecture">Architecture<a href="#architecture" class="hash-link" aria-label="Direct link to Architecture" title="Direct link to Architecture">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_LMjb alert alert--info"><div class="admonitionHeading_GGQ4"><span class="admonitionIcon_ifdW"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_pGk6"><p>Architecture diagram work in progress</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_FNw8" id="managed-alternatives">Managed Alternatives<a href="#managed-alternatives" class="hash-link" aria-label="Direct link to Managed Alternatives" title="Direct link to Managed Alternatives">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_FNw8" id="amazon-managed-streaming-for-apache-kafka-msk">Amazon Managed Streaming for Apache Kafka (MSK)<a href="#amazon-managed-streaming-for-apache-kafka-msk" class="hash-link" aria-label="Direct link to Amazon Managed Streaming for Apache Kafka (MSK)" title="Direct link to Amazon Managed Streaming for Apache Kafka (MSK)">​</a></h3>
<p><a href="https://aws.amazon.com/msk/" target="_blank" rel="noopener noreferrer">Amazon Managed Streaming for Apache Kafka (Amazon MSK)</a> is a fully managed service that enables you to build and run applications that use Apache Kafka to process streaming data. Amazon MSK provides the control-plane operations, such as those for creating, updating, and deleting clusters. It lets you use Apache Kafka data-plane operations, such as those for producing and consuming data. It runs open-source versions of Apache Kafka. This means existing applications, tooling, and plugins from partners and the Apache Kafka community are supported. You can use Amazon MSK to create clusters that use any of the Apache Kafka versions listed under <a href="https://docs.aws.amazon.com/msk/latest/developerguide/supported-kafka-versions.html" target="_blank" rel="noopener noreferrer">Supported Apache Kafka versions</a>. Amazon MSK offers cluster-based or serverless deployment types.</p>
<h3 class="anchor anchorWithStickyNavbar_FNw8" id="amazon-kinesis-data-streams-kds">Amazon Kinesis Data Streams (KDS)<a href="#amazon-kinesis-data-streams-kds" class="hash-link" aria-label="Direct link to Amazon Kinesis Data Streams (KDS)" title="Direct link to Amazon Kinesis Data Streams (KDS)">​</a></h3>
<p><a href="https://aws.amazon.com/kinesis/data-streams/" target="_blank" rel="noopener noreferrer">Amazon Kinesis Data Streams (KDS)</a> allows users to collect and process large streams of data records in real time. You can create data-processing applications, known as Kinesis Data Streams applications. A typical Kinesis Data Streams application reads data from a data stream as data records. You can send the processed records to dashboards, use them to generate alerts, dynamically change pricing and advertising strategies, or send data to a variety of other AWS services. Kinesis Data Streams support your choice of stream processing framework including Kinesis Client Library (KCL), Apache Flink, and Apache Spark Streaming. It is serverless, and scales automatically.</p>
<h2 class="anchor anchorWithStickyNavbar_FNw8" id="storage-considerations-when-self-managing-kafka">Storage considerations when self-managing Kafka<a href="#storage-considerations-when-self-managing-kafka" class="hash-link" aria-label="Direct link to Storage considerations when self-managing Kafka" title="Direct link to Storage considerations when self-managing Kafka">​</a></h2>
<p>The most common resource bottlenecks for Kafka clusters are network throughput, storage throughput, and network throughput between brokers and the storage backend for brokers using network attached storage such as <a href="https://aws.amazon.com/ebs/" target="_blank" rel="noopener noreferrer">Amazon Elastic Block Store (EBS)</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_FNw8" id="advantages-to-using-ebs-as-persistent-storage-backend">Advantages to using EBS as persistent storage backend<a href="#advantages-to-using-ebs-as-persistent-storage-backend" class="hash-link" aria-label="Direct link to Advantages to using EBS as persistent storage backend" title="Direct link to Advantages to using EBS as persistent storage backend">​</a></h3>
<ol>
<li><strong>Improved flexibility and faster recovery:</strong> Fault tolerance is commonly achieved via broker (server) replication within
the cluster and/or maintaining cross-AZ or region replicas. Since the lifecycle of EBS volumes is independent of
Kafka brokers, if a broker fails and needs to be replaced, the EBS volume attached to the failed broker can be reattached to a replacement broker. Most of the replicated data for the replacement broker is already available in the
EBS volume, and does not need to be copied over the network from another broker. This avoids most of the
replication traffic required to bring the replacement broker up to speed with current operations.</li>
<li><strong>Just in time scale up:</strong> The characteristics of EBS volumes can be modified while they’re in use. Broker storage can be
automatically scaled over time rather than provisioning storage for peak or adding additional brokers.</li>
<li><strong>Optimized for frequently-accessed-throughput-intensive workloads:</strong> Volume types such as st1 can be a good fit
since these volumes are offered at a relatively low cost, support a large 1 MiB I/O block size, max IOPS of
500/volume, and includes the ability to burst up to 250 MB/s per TB, with a baseline throughput of 40 MB/s per TB,
and a maximum throughput of 500 MB/s per volume.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_FNw8" id="what-ebs-volumes-should-i-use-when-self-managing-kafka-on-aws">What EBS volumes should I use when self-managing Kafka on AWS?<a href="#what-ebs-volumes-should-i-use-when-self-managing-kafka-on-aws" class="hash-link" aria-label="Direct link to What EBS volumes should I use when self-managing Kafka on AWS?" title="Direct link to What EBS volumes should I use when self-managing Kafka on AWS?">​</a></h3>
<ul>
<li>General purpose SSD volume <strong>gp3</strong> with a balanced price and performance are widely used, and you can <strong>independently</strong> provision storage (up to 16TiB), IOPS (up to 16,000) and throughput (up to 1,000MiB/s)</li>
<li><strong>st1</strong> is a low-cost HDD option for frequently accessed and throughput intensive workloads with up to 500 IOPS and 500 MiB/s</li>
<li>For critical applications such as Zookeeper, provisioned IOPS volumes (<strong>io2 Block Express, io2</strong>) provide higher durability</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_FNw8" id="deploying-the-solution">Deploying the Solution<a href="#deploying-the-solution" class="hash-link" aria-label="Direct link to Deploying the Solution" title="Direct link to Deploying the Solution">​</a></h2>
<p>In this <a href="https://github.com/awslabs/data-on-eks/tree/main/streaming/kafka" target="_blank" rel="noopener noreferrer">example</a>, you will provision the following resources to run Kafka Cluster on EKS.</p>
<p>This example deploys an EKS Cluster with Kafka into a new VPC.</p>
<ul>
<li>Creates a new sample VPC, 3 Private Subnets and 3 Public Subnets.</li>
<li>Creates Internet gateway for Public Subnets and NAT Gateway for Private Subnets.</li>
<li>Creates EKS Cluster Control plane with public endpoint (for demo reasons only) with two managed node groups.</li>
<li>Deploys Metrics server, Cluster Autoscaler, self-managed ebs-csi-driver, Strimzi Kafka Operator, Grafana Operator.</li>
<li>Strimzi Kafka Operator is a Kubernetes Operator for Apache Kafka deployed to <code>strimzi-kafka-operator</code> namespace. The operator by default watches and handles <code>kafka</code> in all namespaces.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_FNw8" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h3>
<p>Ensure that you have installed the following tools on your machine.</p>
<ol>
<li><a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html" target="_blank" rel="noopener noreferrer">aws cli</a></li>
<li><a href="https://Kubernetes.io/docs/tasks/tools/" target="_blank" rel="noopener noreferrer">kubectl</a></li>
<li><a href="https://learn.hashicorp.com/tutorials/terraform/install-cli" target="_blank" rel="noopener noreferrer">terraform</a></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_FNw8" id="deploy">Deploy<a href="#deploy" class="hash-link" aria-label="Direct link to Deploy" title="Direct link to Deploy">​</a></h3>
<p>Clone the repository</p>
<div class="language-bash codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-bash codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/awslabs/data-on-eks.git</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Navigate into one of the example directories and run <code>terraform init</code></p>
<div class="language-bash codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-bash codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">cd data-on-eks/streaming/kafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform init</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Run Terraform plan to verify the resources created by this execution.</p>
<div class="language-bash codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-bash codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">export AWS_REGION=&quot;us-west-2&quot;   # Select your own region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform plan -var=&quot;region=$AWS_REGION&quot;</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Deploy the pattern</p>
<div class="language-bash codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-bash codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">terraform apply -var=&quot;region=$AWS_REGION&quot;</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Enter <code>yes</code> to apply.</p>
<div class="theme-admonition theme-admonition-info admonition_LMjb alert alert--info"><div class="admonitionHeading_GGQ4"><span class="admonitionIcon_ifdW"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_pGk6"><p>This deployment may take between 20 to 30mins.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_FNw8" id="verify-the-deployment">Verify the deployment<a href="#verify-the-deployment" class="hash-link" aria-label="Direct link to Verify the deployment" title="Direct link to Verify the deployment">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_FNw8" id="create-kube-config">Create kube config<a href="#create-kube-config" class="hash-link" aria-label="Direct link to Create kube config" title="Direct link to Create kube config">​</a></h3>
<p>Create kube config file.</p>
<div class="language-bash codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-bash codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">aws eks --region $AWS_REGION update-kubeconfig --name kafka-on-eks</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_FNw8" id="get-nodes">Get nodes<a href="#get-nodes" class="hash-link" aria-label="Direct link to Get nodes" title="Direct link to Get nodes">​</a></h3>
<p>Check if the deployment has created 6 nodes. 3 nodes for Core Node group and 3 for Kafka brokers across 3 AZs.</p>
<div class="language-bash codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-bash codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output</p>
<div class="language-text codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-text codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                        STATUS   ROLES    AGE     VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip-10-0-10-36.us-west-2.compute.internal    Ready    &lt;none&gt;   5h28m   v1.24.7-eks-fb459a0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip-10-0-10-47.us-west-2.compute.internal    Ready    &lt;none&gt;   5h20m   v1.24.7-eks-fb459a0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip-10-0-11-218.us-west-2.compute.internal   Ready    &lt;none&gt;   5h20m   v1.24.7-eks-fb459a0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip-10-0-11-223.us-west-2.compute.internal   Ready    &lt;none&gt;   5h20m   v1.24.7-eks-fb459a0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip-10-0-12-202.us-west-2.compute.internal   Ready    &lt;none&gt;   5h20m   v1.24.7-eks-fb459a0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip-10-0-12-50.us-west-2.compute.internal    Ready    &lt;none&gt;   5h20m   v1.24.7-eks-fb459a0</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_FNw8" id="verify-kafka-brokers-and-zookeeper">Verify Kafka Brokers and Zookeeper<a href="#verify-kafka-brokers-and-zookeeper" class="hash-link" aria-label="Direct link to Verify Kafka Brokers and Zookeeper" title="Direct link to Verify Kafka Brokers and Zookeeper">​</a></h3>
<p>Verify the Kafka Broker and Zookeeper pods and the status created by the Strimzi Operator.</p>
<div class="language-bash codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-bash codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get strimzipodsets.core.strimzi.io -n kafka</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output</p>
<p>NAME                PODS   READY PODS   CURRENT PODS   AGE
cluster-kafka       3      3            3              4h35m
cluster-zookeeper   3      3            3              4h36m</p>
<div class="language-bash codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-bash codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get kafka.kafka.strimzi.io -n kafka</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output</p>
<p>NAME      DESIRED KAFKA REPLICAS   DESIRED ZK REPLICAS   READY   WARNINGS
cluster   3                        3                     True</p>
<div class="language-bash codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-bash codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get kafkatopic.kafka.strimzi.io -n kafka</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output</p>
<p>NAME                                                                                               CLUSTER   PARTITIONS   REPLICATION FACTOR   READY
consumer-offsets---84e7a678d08f4bd226872e5cdd4eb527fadc1c6a                                        cluster   50           3                    True
strimzi-store-topic---effb8e3e057afce1ecf67c3f5d8e4e3ff177fc55                                     cluster   1            3                    True
strimzi-topic-operator-kstreams-topic-store-changelog---b75e702040b99be8a9263134de3507fc0cc4017b   cluster   1            3                    True
strimzi.cruisecontrol.metrics                                                                      cluster   1            3                    True
strimzi.cruisecontrol.modeltrainingsamples                                                         cluster   32           2                    True
strimzi.cruisecontrol.partitionmetricsamples                                                       cluster   32           2                    True</p>
<h3 class="anchor anchorWithStickyNavbar_FNw8" id="verify-the-running-kafka-pods">Verify the running Kafka pods<a href="#verify-the-running-kafka-pods" class="hash-link" aria-label="Direct link to Verify the running Kafka pods" title="Direct link to Verify the running Kafka pods">​</a></h3>
<div class="language-bash codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-bash codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -n kafka</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output</p>
<p>NAME                                       READY   STATUS    RESTARTS   AGE
cluster-cruise-control-79f6457f8d-sm8c2    1/1     Running   0          4h40m
cluster-entity-operator-5594c965ff-t9nl4   3/3     Running   0          4h40m
cluster-kafka-0                            1/1     Running   0          4h41m
cluster-kafka-1                            1/1     Running   0          4h41m
cluster-kafka-2                            1/1     Running   0          4h41m
cluster-kafka-exporter-9dbfdff54-wx8vq     1/1     Running   0          4h39m
cluster-zookeeper-0                        1/1     Running   0          4h42m
cluster-zookeeper-1                        1/1     Running   0          4h42m
cluster-zookeeper-2                        1/1     Running   0          4h42m</p>
<h2 class="anchor anchorWithStickyNavbar_FNw8" id="create-kafka-topic-and-run-sample-test">Create Kafka Topic and run Sample test<a href="#create-kafka-topic-and-run-sample-test" class="hash-link" aria-label="Direct link to Create Kafka Topic and run Sample test" title="Direct link to Create Kafka Topic and run Sample test">​</a></h2>
<p>We will create one kafka topic and run sample producer script to produce new messages to the kafka topic.
We can then verify the data in the topic using sample consumer script.</p>
<h3 class="anchor anchorWithStickyNavbar_FNw8" id="create-a-kafka-topic">Create a kafka Topic<a href="#create-a-kafka-topic" class="hash-link" aria-label="Direct link to Create a kafka Topic" title="Direct link to Create a kafka Topic">​</a></h3>
<p>Run this command to create a new topic called <code>test-topic</code> under <code>kafka</code> namespace</p>
<div class="language-bash codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-bash codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">cd streaming/kafka/examples/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f kafka-topics.yaml</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Verify the status of the <code>test-topic</code> topic.</p>
<div class="language-bash codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-bash codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl exec -it cluster-kafka-0 -c kafka -n kafka -- /bin/bash -c &quot;/opt/kafka/bin/kafka-topics.sh --list --bootstrap-server localhost:9092&quot;</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output</p>
<p>__consumer_offsets
__strimzi-topic-operator-kstreams-topic-store-changelog
__strimzi_store_topic
strimzi.cruisecontrol.metrics
strimzi.cruisecontrol.modeltrainingsamples
strimzi.cruisecontrol.partitionmetricsamples
test-topic</p>
<h3 class="anchor anchorWithStickyNavbar_FNw8" id="execute-sample-kafka-producer">Execute sample Kafka Producer<a href="#execute-sample-kafka-producer" class="hash-link" aria-label="Direct link to Execute sample Kafka Producer" title="Direct link to Execute sample Kafka Producer">​</a></h3>
<p>Open two terminals one for Kafka producer and one for Kafka Consumer.</p>
<p>Execute the following command and press enter twice until you see the <code>&gt;</code> prompt.
Start typing some random content. This data will be written to the <code>test-topic</code>.</p>
<div class="language-bash codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-bash codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl -n kafka run kafka-producer -ti --image=strimzi/kafka:0.14.0-kafka-2.3.0 --rm=true --restart=Never -- bin/kafka-console-producer.sh --broker-list cluster-kafka-bootstrap:9092 --topic test-topic</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_FNw8" id="execute-sample-kafka-consumer">Execute sample Kafka Consumer<a href="#execute-sample-kafka-consumer" class="hash-link" aria-label="Direct link to Execute sample Kafka Consumer" title="Direct link to Execute sample Kafka Consumer">​</a></h3>
<p>Now, you can verify the data written to <code>test-topic</code> by running Kafka consumer pod in another terminal</p>
<div class="language-bash codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-bash codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl -n kafka run kafka-consumer -ti --image=strimzi/kafka:0.14.0-kafka-2.3.0 --rm=true --restart=Never -- bin/kafka-console-consumer.sh --bootstrap-server cluster-kafka-bootstrap:9092 --topic test-topic</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_FNw8" id="kafka-producer-and-consumer-output">Kafka Producer and Consumer output<a href="#kafka-producer-and-consumer-output" class="hash-link" aria-label="Direct link to Kafka Producer and Consumer output" title="Direct link to Kafka Producer and Consumer output">​</a></h3>
<p><img loading="lazy" alt="img.png" src="/data-on-eks/assets/images/kafka-consumer-01c14ea820310599340014ad2a739658.png" width="963" height="402" class="img_wQsy"></p>
<h2 class="anchor anchorWithStickyNavbar_FNw8" id="grafana-dashboard-for-kafka">Grafana Dashboard for Kafka<a href="#grafana-dashboard-for-kafka" class="hash-link" aria-label="Direct link to Grafana Dashboard for Kafka" title="Direct link to Grafana Dashboard for Kafka">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_FNw8" id="login-to-grafana">Login to Grafana<a href="#login-to-grafana" class="hash-link" aria-label="Direct link to Login to Grafana" title="Direct link to Login to Grafana">​</a></h3>
<p>Login to Grafana dashboard by running the following command.</p>
<div class="language-bash codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-bash codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward svc/kube-prometheus-stack-grafana 8080:80 -n kube-prometheus-stack</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Open browser with local <a href="http://localhost:8080/" target="_blank" rel="noopener noreferrer">Grafana Web UI</a></p>
<p>Enter username as <code>admin</code> and <strong>password</strong> can be extracted from AWS Secrets Manager with the below command.</p>
<div class="language-bash codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-bash codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">aws secretsmanager get-secret-value \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --secret-id kafka-on-eks-grafana --region $AWS_REGION --query &quot;SecretString&quot; --output text</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_FNw8" id="open-strimzi-kafka-dashboard">Open Strimzi Kafka Dashboard<a href="#open-strimzi-kafka-dashboard" class="hash-link" aria-label="Direct link to Open Strimzi Kafka Dashboard" title="Direct link to Open Strimzi Kafka Dashboard">​</a></h3>
<p>The below are builtin Kafka dashboards which created during the deployment.</p>
<p><img loading="lazy" alt="Kafka Brokers Dashboard" src="/data-on-eks/assets/images/kafka-brokers-3ed196a07f8868ea98eea0082008e559.png" width="3734" height="2414" class="img_wQsy"></p>
<h3 class="anchor anchorWithStickyNavbar_FNw8" id="open-strimzi-zookeeper-dashboard">Open Strimzi Zookeeper Dashboard<a href="#open-strimzi-zookeeper-dashboard" class="hash-link" aria-label="Direct link to Open Strimzi Zookeeper Dashboard" title="Direct link to Open Strimzi Zookeeper Dashboard">​</a></h3>
<p><img loading="lazy" alt="Kafka Zookeeper" src="/data-on-eks/assets/images/zookeeper-f584217306081c0f547b33dff0976d59.png" width="3726" height="2412" class="img_wQsy"></p>
<h3 class="anchor anchorWithStickyNavbar_FNw8" id="open-strimzi-kafka-exporter">Open Strimzi Kafka Exporter<a href="#open-strimzi-kafka-exporter" class="hash-link" aria-label="Direct link to Open Strimzi Kafka Exporter" title="Direct link to Open Strimzi Kafka Exporter">​</a></h3>
<p>You can verify the <code>test-topic</code> with three partitions below.</p>
<p><img loading="lazy" alt="img.png" src="/data-on-eks/assets/images/kafka-exporter-aff2e5b0fd63b3ecb0fbb565ded5f024.png" width="3730" height="2382" class="img_wQsy"></p>
<h2 class="anchor anchorWithStickyNavbar_FNw8" id="cleanup">Cleanup<a href="#cleanup" class="hash-link" aria-label="Direct link to Cleanup" title="Direct link to Cleanup">​</a></h2>
<p>To clean up your environment, destroy the Terraform modules in reverse order with <code>--target</code> option to avoid destroy failures.</p>
<p>Destroy the Kubernetes Add-ons, EKS cluster with Node groups and VPC</p>
<div class="language-bash codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-bash codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">terraform destroy -target=&quot;module.eks_blueprints_kubernetes_addons&quot; -auto-approve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform destroy -target=&quot;module.eks_blueprints&quot; -auto-approve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform destroy -target=&quot;module.vpc&quot; -auto-approve</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Finally, destroy any additional resources that are not in the above modules</p>
<div class="language-bash codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-bash codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">terraform destroy -auto-approve</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-caution admonition_LMjb alert alert--warning"><div class="admonitionHeading_GGQ4"><span class="admonitionIcon_ifdW"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_pGk6"><p>To avoid unwanted charges to your AWS account, delete all the AWS resources created during this deployment</p><p>ex. Delete kafka-on-eks EBS volumes</p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/awslabs/data-on-eks/blob/main/website/docs/blueprints/streaming-platforms/kafka.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_NulP" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated__GQF"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/data-on-eks/docs/blueprints/streaming-platforms/flink"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Flink Operator on EKS</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/data-on-eks/docs/blueprints/streaming-platforms/nifi"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Apache NiFi on EKS</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_IS5x thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#strimzi-for-apache-kafka" class="table-of-contents__link toc-highlight">Strimzi for Apache Kafka</a></li><li><a href="#architecture" class="table-of-contents__link toc-highlight">Architecture</a></li><li><a href="#managed-alternatives" class="table-of-contents__link toc-highlight">Managed Alternatives</a><ul><li><a href="#amazon-managed-streaming-for-apache-kafka-msk" class="table-of-contents__link toc-highlight">Amazon Managed Streaming for Apache Kafka (MSK)</a></li><li><a href="#amazon-kinesis-data-streams-kds" class="table-of-contents__link toc-highlight">Amazon Kinesis Data Streams (KDS)</a></li></ul></li><li><a href="#storage-considerations-when-self-managing-kafka" class="table-of-contents__link toc-highlight">Storage considerations when self-managing Kafka</a><ul><li><a href="#advantages-to-using-ebs-as-persistent-storage-backend" class="table-of-contents__link toc-highlight">Advantages to using EBS as persistent storage backend</a></li><li><a href="#what-ebs-volumes-should-i-use-when-self-managing-kafka-on-aws" class="table-of-contents__link toc-highlight">What EBS volumes should I use when self-managing Kafka on AWS?</a></li></ul></li><li><a href="#deploying-the-solution" class="table-of-contents__link toc-highlight">Deploying the Solution</a><ul><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#deploy" class="table-of-contents__link toc-highlight">Deploy</a></li></ul></li><li><a href="#verify-the-deployment" class="table-of-contents__link toc-highlight">Verify the deployment</a><ul><li><a href="#create-kube-config" class="table-of-contents__link toc-highlight">Create kube config</a></li><li><a href="#get-nodes" class="table-of-contents__link toc-highlight">Get nodes</a></li><li><a href="#verify-kafka-brokers-and-zookeeper" class="table-of-contents__link toc-highlight">Verify Kafka Brokers and Zookeeper</a></li><li><a href="#verify-the-running-kafka-pods" class="table-of-contents__link toc-highlight">Verify the running Kafka pods</a></li></ul></li><li><a href="#create-kafka-topic-and-run-sample-test" class="table-of-contents__link toc-highlight">Create Kafka Topic and run Sample test</a><ul><li><a href="#create-a-kafka-topic" class="table-of-contents__link toc-highlight">Create a kafka Topic</a></li><li><a href="#execute-sample-kafka-producer" class="table-of-contents__link toc-highlight">Execute sample Kafka Producer</a></li><li><a href="#execute-sample-kafka-consumer" class="table-of-contents__link toc-highlight">Execute sample Kafka Consumer</a></li><li><a href="#kafka-producer-and-consumer-output" class="table-of-contents__link toc-highlight">Kafka Producer and Consumer output</a></li></ul></li><li><a href="#grafana-dashboard-for-kafka" class="table-of-contents__link toc-highlight">Grafana Dashboard for Kafka</a><ul><li><a href="#login-to-grafana" class="table-of-contents__link toc-highlight">Login to Grafana</a></li><li><a href="#open-strimzi-kafka-dashboard" class="table-of-contents__link toc-highlight">Open Strimzi Kafka Dashboard</a></li><li><a href="#open-strimzi-zookeeper-dashboard" class="table-of-contents__link toc-highlight">Open Strimzi Zookeeper Dashboard</a></li><li><a href="#open-strimzi-kafka-exporter" class="table-of-contents__link toc-highlight">Open Strimzi Kafka Exporter</a></li></ul></li><li><a href="#cleanup" class="table-of-contents__link toc-highlight">Cleanup</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Get Started</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/data-on-eks/docs/introduction/intro">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Get Involved</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/awslabs/data-on-eks" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_T11m"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Built with ❤️ at AWS  <br> © 2024 Amazon.com, Inc. or its affiliates. All Rights Reserved</div></div></div></footer></div>
</body>
</html>