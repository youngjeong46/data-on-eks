"use strict";(self.webpackChunkdoeks_website=self.webpackChunkdoeks_website||[]).push([[1060],{4535:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>c,toc:()=>d});var i=t(5893),s=t(1151),r=t(769);const a={sidebar_position:3,sidebar_label:"JupyterHub on EKS"},o="JupyterHub on EKS",c={id:"blueprints/ai-ml/jupyterhub",title:"JupyterHub on EKS",description:"Note: We are actively working on enhancing this blueprint with additional functionalities to make it more enterprise-ready.",source:"@site/docs/blueprints/ai-ml/jupyterhub.md",sourceDirName:"blueprints/ai-ml",slug:"/blueprints/ai-ml/jupyterhub",permalink:"/data-on-eks/docs/blueprints/ai-ml/jupyterhub",draft:!1,unlisted:!1,editUrl:"https://github.com/awslabs/data-on-eks/blob/main/website/docs/blueprints/ai-ml/jupyterhub.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,sidebar_label:"JupyterHub on EKS"},sidebar:"blueprints",previous:{title:"Ray on EKS",permalink:"/data-on-eks/docs/blueprints/ai-ml/ray"},next:{title:"EMR NVIDIA Spark-RAPIDS",permalink:"/data-on-eks/docs/blueprints/ai-ml/emr-spark-rapids"}},l={},d=[{value:"Introduction",id:"introduction",level:2},{value:"JupyterHub on EKS",id:"jupyterhub-on-eks-1",level:2},{value:"Deploy",id:"deploy",level:3},{value:"Login into JupyterHub via Amazon Cognito",id:"login-into-jupyterhub-via-amazon-cognito",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"jupyterhub-on-eks",children:"JupyterHub on EKS"}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"Note: We are actively working on enhancing this blueprint with additional functionalities to make it more enterprise-ready."})}),"\n",(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://jupyter.org/hub",children:"JupyterHub"}),' is a powerful multi-user server that enables users to access and interact with Jupyter notebooks and other Jupyter-compatible environments. It provides a collaborative platform where multiple users can simultaneously access and utilize notebooks, fostering collaboration and sharing among users. JupyterHub allows users to create their own isolated computing environments (known as "spawners") and launch Jupyter notebooks or other interactive computing environments within those environments. This provides each user with their own workspace, including files, code, and computational resources.']}),"\n",(0,i.jsx)(n.h2,{id:"jupyterhub-on-eks-1",children:"JupyterHub on EKS"}),"\n",(0,i.jsx)(n.p,{children:"JupyterHub on Amazon Elastic Kubernetes Service (EKS) combines the versatility of JupyterHub with the scalability and flexibility of Kubernetes. By deploying JupyterHub on EKS, you can easily manage and maintain a shared Jupyter notebook environment for multiple users. This environment serves as a collaborative and interactive platform for various tasks such as data science, machine learning, and research. The JupyterHub add-on is built upon the JupyterHub project, which supports a multi-user Hub capable of spawning, managing, and proxying multiple instances of single-user Jupyter notebook servers."}),"\n",(0,i.jsx)(n.p,{children:"By leveraging the capabilities of EKS, you can seamlessly scale your JupyterHub environment to meet the needs of your users, ensuring efficient resource utilization and optimal performance. With EKS, you can take advantage of Kubernetes features such as automated scaling, high availability, and easy deployment of updates and upgrades. This enables you to provide a reliable and robust JupyterHub experience for your users, empowering them to collaborate, explore, and analyze data effectively.\nTo get started with JupyterHub on EKS, follow the instructions in this guide to set up and configure your JupyterHub environment."}),"\n",(0,i.jsxs)(r.Z,{header:(0,i.jsx)(n.h3,{children:(0,i.jsx)(n.span,{children:"Deploying the Solution"})}),children:[(0,i.jsxs)(n.p,{children:["This ",(0,i.jsx)(n.a,{href:"https://github.com/awslabs/data-on-eks/tree/main/ai-ml/jupyterhub",children:"blueprint"}),"  deploys the following components:"]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Creates a new sample VPC, 2 Private Subnets, and 2 Public Subnets. Link to VPC documentation"}),"\n",(0,i.jsx)(n.li,{children:"Sets up an Internet gateway for Public Subnets and NAT Gateway for Private Subnets."}),"\n",(0,i.jsx)(n.li,{children:"Creates an EKS Cluster Control plane with a public endpoint (for demo purposes only) and a core managed node group."}),"\n",(0,i.jsxs)(n.li,{children:["Deploys the ",(0,i.jsx)(n.a,{href:"https://hub.jupyter.org/helm-chart/",children:"JupyterHub Helm chart"})," to set up JupyterHub."]}),"\n",(0,i.jsx)(n.li,{children:"Exposes the JupyterHub proxy using an AWS Network Load Balancer."}),"\n",(0,i.jsx)(n.li,{children:"Deploys the EBS CSI driver add-on to enable the use of EBS persistent storage for the EKS data plane."}),"\n",(0,i.jsx)(n.li,{children:"Sets up two EFS storage mounts: one for personal storage and one for shared storage."}),"\n",(0,i.jsxs)(n.li,{children:["Authenticates users using ",(0,i.jsx)(n.a,{href:"https://aws.amazon.com/cognito/",children:"Amazon Cognito"})," user pools. Link to Cognito documentation"]}),"\n"]}),(0,i.jsx)(n.p,{children:"By following this blueprint, you can easily deploy and configure a JupyterHub environment on EKS, leveraging various AWS services to provide a collaborative and scalable platform for your users."}),(0,i.jsxs)(r.Z,{header:(0,i.jsx)(n.h3,{children:(0,i.jsx)(n.span,{children:"Pre-requisites"})}),children:[(0,i.jsx)(n.p,{children:"Ensure that you have installed the following tools on your machine."}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html",children:"aws cli"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://Kubernetes.io/docs/tasks/tools/",children:"kubectl"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://learn.hashicorp.com/tutorials/terraform/install-cli",children:"terraform"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Domain Name"}),": You need to bring your own domain name to host the JupyterHub WebUI with a custom domain. For testing purposes, you can use a free domain service provider such as ",(0,i.jsx)(n.a,{href:"https://www.changeip.com/accounts/index.php",children:"ChangeIP"})," to create a test domain. However, please note that using ChangeIP or similar services for hosting your production or development clusters with JupyterHub is not recommended. Ensure that you review the terms and conditions of using such services."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"SSL Certificate"}),": You will also need to obtain an SSL certificate from a trusted Certificate Authority (CA) or through your web hosting provider to attach to the domain. For testing environments, you can generate a self-signed certificate using the OpenSSL service."]}),"\n"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"openssl req -newkey rsa:2048 -nodes -keyout key.pem -x509 -days 365 -out certificate.pem\n"})}),(0,i.jsx)(n.p,{children:"When creating the certificate use a wildcard, so that it can secure a domain and all its subdomains with a single certificate\nThe service generates the private key and self-signed certificate.\nSample prompts to generate a certificate :"}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:t(7179).Z+"",width:"1852",height:"1064"})}),(0,i.jsxs)(n.ol,{start:"6",children:["\n",(0,i.jsx)(n.li,{children:"Import the certificate into AWS Certificate Manager"}),"\n"]}),(0,i.jsxs)(n.p,{children:["Open the private key(",(0,i.jsx)(n.code,{children:"key.pem"}),") in a text editor and copy the contents into the private key section of ACM. Similarly, copy the contents of the ",(0,i.jsx)(n.code,{children:"certificate.pem"})," file into the certificate body section and submit."]}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:t(9340).Z+"",width:"2586",height:"1120"})}),(0,i.jsx)(n.p,{children:"Verify certificate is installed correctly in the console in ACM."}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:t(5057).Z+"",width:"2788",height:"1064"})})]}),(0,i.jsx)(n.h3,{id:"deploy",children:"Deploy"}),(0,i.jsx)(n.p,{children:"Clone the repository"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/awslabs/data-on-eks.git\n"})}),(0,i.jsx)(n.p,{children:"Navigate into one of the blueprint directory"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd data-on-eks/ai-ml/jupyterhub && chmod +x install.sh\n"})}),(0,i.jsx)(n.p,{children:"####\xa0Run the install script"}),(0,i.jsxs)(n.p,{children:["Use the provided helper script ",(0,i.jsx)(n.code,{children:"install.sh"})," to run the terraform init and apply commands. By default the script deploys EKS cluster to ",(0,i.jsx)(n.code,{children:"us-west-2"})," region. Update ",(0,i.jsx)(n.code,{children:"variables.tf"})," to change the region or other variables."]}),(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsxs)(n.p,{children:["Please note that during the execution of this script, you will be prompted to provide input values for 'JupyterHub Auth Mechanisms'(",(0,i.jsx)(n.code,{children:"jupyter_hub_auth_mechanism"}),"), 'Certificate Domain'(",(0,i.jsx)(n.code,{children:"acm_certificate_domain"}),") and 'Sub-domain(",(0,i.jsx)(n.code,{children:"jupyterhub_domain"}),") for JupyterHub'."]}),(0,i.jsxs)(n.p,{children:["For 'JupyterHub Auth Mechanisms', please provide ",(0,i.jsx)(n.code,{children:"cognito"})," as your desired value."]}),(0,i.jsxs)(n.p,{children:["For 'Certificate Domain', please provide the wildcard root domain for which the SSL certificate has been imported into AWS Certificate Manager (ACM). An example of this could be ",(0,i.jsx)(n.code,{children:"*.jupyterhubeks.dynamic-dns.net"}),"."]}),(0,i.jsxs)(n.p,{children:["Regarding the 'Sub-domain for JupyterHub', please provide the fully qualified domain name (FQDN) where you want to host your JupyterHub. For instance, you can use eks.",(0,i.jsx)(n.code,{children:"eks.jupyterhubeks.dynamic-dns.net"})," as the sub-domain."]}),(0,i.jsx)(n.p,{children:"Make sure to provide the appropriate values for these inputs when prompted."})]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./install.sh\n"})})]}),"\n",(0,i.jsxs)(r.Z,{header:(0,i.jsx)(n.h3,{children:(0,i.jsx)(n.span,{children:"Verify the resources"})}),children:[(0,i.jsx)(n.p,{children:"To validate that the JupyterHub add-on is running ensure that the add-on deployments for the controller and the webhook are in RUNNING state."}),(0,i.jsx)(n.p,{children:"Run the following command"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -n jupyterhub\n"})}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:t(6413).Z+"",width:"2342",height:"244"})}),(0,i.jsx)(n.p,{children:"JupyterHub, by default, creates a proxy service called proxy-public which is exposed by Load Balancer."}),(0,i.jsx)(n.p,{children:"To validate that the proxy service and running and exposed via LoadBalancer."}),(0,i.jsx)(n.p,{children:"Run the following command"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get svc -n jupyterhub\n"})}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:t(4796).Z+"",width:"2492",height:"144"})})]}),"\n",(0,i.jsx)(n.h3,{id:"login-into-jupyterhub-via-amazon-cognito",children:"Login into JupyterHub via Amazon Cognito"}),"\n",(0,i.jsxs)(n.p,{children:["Add the ",(0,i.jsx)(n.code,{children:"CNAME"})," DNS record in ChangeIP for the JupyterHub domain with the load balancer DNS name."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:t(8927).Z+"",width:"2210",height:"1160"})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["When adding the load balancer DNS name in the value field of CNAME in ChangeIP make sure to add a dot(",(0,i.jsx)(n.code,{children:"."}),") at the end of the load-balancer DNS name."]})}),"\n",(0,i.jsx)(n.p,{children:"Now typing the domain url in the browser should redirect to the Cognito login page."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:t(5655).Z+"",width:"2414",height:"1194"})}),"\n",(0,i.jsx)(n.p,{children:"Follow the Cognito sign-up and sign-in process to login."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:t(9112).Z+"",width:"2414",height:"1194"})}),"\n",(0,i.jsx)(n.p,{children:"Successful sign-in will open up the JupyterHub environment for the logged in user."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:t(7387).Z+"",width:"2636",height:"1496"})}),"\n",(0,i.jsx)(n.p,{children:"To test the setup of the shared and personal directories in JupyterHub, you can follow these steps:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Open a terminal window from the launcher dashboard."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:t(6387).Z+"",width:"2636",height:"818"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"execute the command"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"df -h\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Verify EFS mounts created. Each user's private home directory is available at ",(0,i.jsx)(n.code,{children:"/home/jovyan"}),". The shared directory is available at ",(0,i.jsx)(n.code,{children:"/home/shared"})]}),"\n",(0,i.jsxs)(r.Z,{header:(0,i.jsx)(n.h3,{children:(0,i.jsx)(n.span,{children:"Cleanup"})}),children:[(0,i.jsx)(n.admonition,{type:"caution",children:(0,i.jsx)(n.p,{children:"To avoid unwanted charges to your AWS account, delete all the AWS resources created during this deployment."})}),(0,i.jsx)(n.p,{children:"This script will cleanup the environment using -target option to ensure all the resources are deleted in correct order."}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd data-on-eks/ai-ml/jupyterhub/ && chmod +x cleanup.sh\n./cleanup.sh\n"})})]})]})}function u(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},769:(e,n,t)=>{t.d(n,{Z:()=>m});var i=t(7294),s=t(5697),r=t.n(s),a=t(512);const o="collapsibleContent_q3kw",c="header_QCEw",l="icon_PckA",d="content_qLC1",h="expanded_iGsi";var u=t(5893);function p(e){let{children:n,header:t}=e;const[s,r]=(0,i.useState)(!1);return(0,u.jsxs)("div",{className:o,children:[(0,u.jsxs)("div",{className:(0,a.Z)(c,{[h]:s}),onClick:()=>{r(!s)},children:[t,(0,u.jsx)("span",{className:(0,a.Z)(l,{[h]:s}),children:s?"\ud83d\udc47":"\ud83d\udc48"})]}),s&&(0,u.jsx)("div",{className:d,children:n})]})}p.propTypes={children:r().node.isRequired,header:r().node.isRequired};const m=p},9340:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/ACM-bf5924d27455ec9688fed998604447c8.png"},8927:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/CNAME-01756088c6813c9470444a90b156a86f.png"},7179:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/Cert_Install-d7de3b8c77bf1e22b7093aa282c871a1.png"},5057:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/Cert_List-a1d44ed2b31bc39ad55683b72e7eb2e3.png"},5655:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/Cognito-Sign-in-bbcaa40e987306f996cc03fdff219c83.png"},9112:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/Cognito-Sign-up-e1ff617d347d33581e59d9d9489db38c.png"},6387:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/jupyter_env-a0482d359d963ae4046133be818467f9.png"},7387:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/jupyter_launcher-ac52cf79eab3c6de206d1b12e93d5f52.png"},6413:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/jupyterhub_running-d5f0d4ec14750f537c7aba8860eccec3.png"},4796:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/jupyterhub_service-399e2c1681fdbe2c1a0796a685a2c430.png"},1151:(e,n,t)=>{t.d(n,{Z:()=>o,a:()=>a});var i=t(7294);const s={},r=i.createContext(s);function a(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);